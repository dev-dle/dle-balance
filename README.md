#Установка модуля

Для установки модуля необходимо:
----
1) DLE >= 13 версии:
    - Скачать актуальную версию модуля (ссылка)
    - Зайти в админпанель, в разделе утилиты найти вкладку “Управление плагинами”
    - Нажать на кнопку “загрузить плагин”, выбрать архив с актуальной версией модуля и подтвердить действие. После этого модуль будет установлен в автоматическом режиме.

2) DLE 11 и 12 версии:
    -  Скачать актуальную версию модуля (ссылка)
    -  Распаковать архив с модулем в корне вашего сайта
    -  Запустить установочный файл ccdn-install.php. После этого модуль будет установлен в автоматическом режиме


Для DLE ниже 13 так же рекомендуется (на DLE >= 13 это делается автоматически), чтобы всегда поддерживать актуальные домены на постеры и эмбеды (в случае блокировки колапса), необходимо внести следующие изменения в engine/classes/templates.class.php:  

Найти и вставить ПЕРЕД:
```php
class dle_template {
```
Следующий код:
```php
if (file_exists(ROOT_DIR . '/engine/classes/CCDN/ccdn.class.php')) {
    require_once ROOT_DIR . '/engine/classes/CCDN/ccdn.class.php';
    $ccdn = new CCDN();
} else {
    $ccdn = null;
}
```

Найти и вставить ПОСЛЕ:
```php
function compile($tpl) {
```
Следующий код:
```php
global $ccdn;
if ($ccdn !== null) {
    $ccdn->preCompile($this);
}
```

Обновление модуля
----

####Для того чтобы обновить модуль необходимо:

1) DLE >= 13 версии:
	-  Скачать актуальную версию модуля (ссылка)
	-  Зайти в админпанель, в разделе утилиты найти вкладку “Управление плагинами”
	-  Найти наш плагин и нажать на выпадающее меню
	-  Нажать на пункт “Обновить плагин” и в открывшемся окне указать архив с новой версией модуля и подтвердить действие. После этого у вас будет установлена новая версия.

2) DLE 11 и 12 версии:
	-  Скачать актуальную версию модуля (ссылка)
    -  Распаковать архив с модулем в корне вашего сайта с заменой файлов



Настройки
----

####Основные настройки

Данный раздел содержит настройки полей, без которых невозможна корректная работа модуля. Без указания вашего API токена, поля, в которое модуль будет проставлять ссылки на наши материалы, поля для Collaps ID, и хотя бы одного из полей с ID kinopoisk, IMDB или WorldArt, работа модуля будет невозможна. Перед началом работы с модулем убедитесь, что эти поля заполнены.

####Настройки массового обновления

Данный раздел содержит дополнительные настройки полей, которые будут заполняться при нажатии на кнопку “Обновить эмбеды” на главной странице модуля.

“Доп. поле для вставки качества видео” - в данное поле модуль будет записывать информацию об актуальном качестве видеоматериала в базе Collaps (TS, SD, HD (720p), FHD (1080p))

“Доп. поле для вставки всех доступных озвучек” - сюда модуль, через запятую, запишет все имеющиеся озвучки к материалу.

“Доп. поле для вставки первой озвучки” - в это поле модуль запишет только первую из доступных озвучек. Удобно, если выводите озвучку на главной сайта. Кроме того вы можете задать приоритет для первой озвучки, если какая-то из заданных озвучек доступна для видео, то в данное доп поле будет проставлена именно она, даже если в базе Collaps первая озвучка другая.

“Доп. поле для статуса новости” - поле, типа да/нет, при его указании значение по умолчанию должно быть “да”. Перевод на значение “нет” в новости даст понять модулю, что для данного материала данные проставлять не нужно. Удобно если вы убираете плеер из новости на которую пришла жалоба от правообладателей, чтобы при массовом обновлении ссылок, плеер не вернулся на данную страницу.

“Доп. поле для выбора сезона” - сюда модуль будет проставлять номер последнего доступного сезона

“Доп. поле для выбора серии” - сюда модуль будет проставлять номер последней доступной серии

“Текст для добавления в поле с сезонами” - текст из данного поля будет дописан к полю “Доп. поле для выбора сезона”

“Текст для добавления в поле с серией” - текст из данного поля будет дописан к полю “Доп. поле для выбора серии”

“Доп. поле для вставки количества серий” - в это поле будет записано общее количество эпизодов материала, это поле обязательно для заполнения, если вы планируете использовать функционал вкладки “Модуль обновления новостей”. Именно по этому полю осуществляется проверка, появилась ли новая серия в базе балансера!!!

“Добавлять сезон серию в ссылку на эмбед” - если значение “true” - то к ссылке на на материал будут дописаны параметры сезона и серии, а на странице будет открыт сразу последний доступный сезон и серия материала. Если значение “false” то ссылка будет без каких-либо параметров, а на странице будет открыт первый сезон и первая серия сериала

“Фильтровать контент с рекламой” - если значение “true”, то модуль не будет проставлять данные к материалам, в которых присутствует вшитая реклама азарта. Если значение “false” то данные будут проставляться ко всем материалам из вашей базы доступным на балансере

“Доп. поле для вставки статуса рекламы” - это поле типа “переключатель да/нет” модуль будет его в положение “да”, если в видео есть вшитая реклама. Переключатель останется в положении “нет”, если вшитой рекламы нет.

“Доп. поле для вставки трейлера” - в это доп поле модуль будет проставлять ссылку на трейлер из базы Collaps (если он у них есть).

“Приоритет озвучек для вставки первой озвучки в доп. поле - здесь вы можете задать порядок, в котором будут проставляться озвучки в “Доп. поле для вставки первой озвучки”. Например если у “Сверхъестественного” в базе Collaps на первом  месте стоит озвучка LostFilm, а у вас в приоритете указана студия NovaFilm, то в доп поле первой озвучки будет проставлена именно озвучка NovaFilm.

“Заблокированные озвучки в плеере” - здесь можно задать, какие озвучки вам не нужны, модуль допишет к ссылкам на видео параметр, исключающий данные озвучки с плеера (если данная озвучка НЕ единственная).


####Настройки кнопки

В этом разделе вы можете настроить какие поля будет заполнять модуль при нажатии на кнопку “найти эмбед” при создании или редактировании новости.

“Доступы для кнопки поиска в новостях” - здесь  можно указать каким категория пользователей будет показана кнопка “найти эмбед” при создании и редактировании новости

“Проставлять связанные категории” - если настройка активна, то при создании новости модуль также будет проставлять категории к материалу, привязка будет согласно настройкам, указанным во вкладке “Новые франшизы”

Если у вас ДЛЕ ниже 13 версии, то чтобы добавить разместите код ниже

`if (file_exists(ENGINE_DIR . '/inc/CCDN/button.php')) { $output .= include ENGINE_DIR . '/inc/CCDN/button.php';}`

В файлы `engine/inc/addnews.php` и `engine/inc/editnews.php`, предварительно сбросив cache в админ панели.

Если кнопка не появилась то в папке ` engine/cache/system/plugins` удалите все cache файлы!


####Модуль обновлений новостей

Для использования модуля необходимо добавить данный код:
`{include file="engine/modules/ccdn.php"}`
В шаблон новостей вашего сайта - `fullstory.tpl`

В этом разделе вы можете настроить модуль на поднятие новостей по выходу новых серий. Но для его использования вам НЕОБХОДИМО в настройках указать доп поле для записи общего количества эпизодов сериала (“Доп. поле для вставки количества серий”) без этой информации поднятие не будет работать.

При поднятии сериалов модуль также может изменять Заголовок, Метатег title и ЧПУ для материала. Для корректного отображения вам нужно создать нужный шаблон из доступных параметров и текста и указать его в поле “Форматирование исходящего заголовка”.

Также модуль может изменять Заголовок, Метатег title и ЧПУ для не сезонных материалов (фильмы/мультфильмы). Для корректного отображения вам нужно создать нужный шаблон из доступных параметров и текста и указать его в поле “Форматирование исходящего заголовка для не сезонных франшиз”.

Важно!
В поля “Доп. поля для вставки сезона” и “Доп. поля для вставки серии” можно проставить ФОРМАТИРОВАННЫЙ номер сезона и серии. Здесь не нужно указывать поле, в которое вы пишите номер сезона/серии сериала иначе они будут перезаписываться при каждом обновлении.
Модуль календарь

Одна из особенностей модуля CCDN - календарь. В этой вкладке вы сможете настроить для своего сайта календарь обновлений на главной странице сайта, а также график выхода новых серий сериалов в самой новости.

Важно!
Для работы календаря необходимо заполнить **“Доп. поле для вставки Collaps id”**, без Collaps id календарь работать не будет, ввиду особенностей API балансера.
Также переместите папку `templates/ваш шаблон/ccdn-calendar` в корень папки вашего активного шаблона!

После настройки календаря стоит сбросить кэш модуля, ДЛЕ.

Перемещение папки с календарем в корень активного шаблона даст вам возможность настроить внешний вид календарей под ваш сайт. Чтобы сделать это вам нужно зайти во вкладку с шаблонами вашего сайта и отыскать там ccdn-calendar
Внутри вы найдете папку main (отвечает за внешний вид календаря в `main.tpl)` и full (отвечает за внешний вид графика выхода серий в `fullstory.tpl`). Здесь:
- `item.tpl` - код отдельной строки календаря
- `full.tpl` -   код всего блока графика выхода серий (`fullstory.tpl`)
- `day.tpl` - код блока отдельного дня в календаре (`main.tp`l)
- `main.tpl` - код всего блока календаря (`main.tpl`)

Здесь вы можете настроить вывод календаря и его внешний вид. Он поддерживает работу как с внутренними параметрами, так и с вашими доп. полями

Чтобы нужный вам календарь появился на страницах вашего сайта нужно поместить в шаблон код ниже.

График выхода новых серий в новости (код поместить в `fullstory.tpl`):
`{include file="engine/modules/ccdn-calendar-fullstory.php"}`
Доступно два режима работы:
вывод графика выхода серий только на будущее
вывод полного графика выхода серий (и на предыдущие серии тоже)

В папке `/ccdn-calendar/full` есть еще ще две подпапки `all/last` они задействуются в зависимости от выбранного режима работы календаря в новости

Календарь на главной (код поместить в main.tpl):
`{include file="engine/modules/ccdn-calendar-main.php"}`
Для этого календаря доступно два типа сортировки
сегодняшний день выше за предыдущий
сегодняшний день ниже за предыдущий

####Части франшиз

Данный модуль при размещении его в `fullstory.tpl` позволяет выводить на странице материала блок с другими частями фильма, с ссылками на соответствующие новости.

Для функционирования модуля нужно проставить Collaps Id, заполнив во вкладке "Настройки" поле "Доп. поле для вставки Collaps id".
Также переместите папку `templates/ваш шаблон/ccdn-franchise-parts` в корень папки вашего активного шаблона!
Далее блок можно кастомизировать под дизайн вашего сайта во вкладке “шаблоны сайта”.



####Новые франшизы

В этом разделе у вас есть возможность следить за обновлениями в базе Collaps и сразу добавлять к себе новости, которых еще нет у вас на сайте.

При создании новости модуль может заполнить данные о материале. Для создаваемой новости вы можете настроить поля, которые будут автоматически заполняться модулем. Также если новый материал связан с интересующей вас подборкой балансера, вы можете настроить связку подборки с вашей категорией и при создании материалу будет присвоена нужная категория.

Важно!
Созданные новости публикуются автоматически, только если вы задали соответствующую настройку!

Парсинг базы Collaps

Раздел позволит вам сверить материалы, которые есть в базе Collaps с материалами, которые уже есть у вас на сайте и при необходимости добавить себе недостающие.

При нажатии на кнопку “добавить” модуль создаст соответствующую новость и заполнит нужные данные о материале. При заполнении модуль будет ориентироваться на настройки, указанные в разделе “Новые франшизы”.

Кроме того вы можете спарсить себе все франшизы Collaps определенного типа. Доступны также фильтры зависимо от года, жанра либо страны материалов. При парсинге модуль также будет ориентироваться на настройки, указанные в разделе “Новые франшизы”.

Важно!
Созданные новости публикуются автоматически, только если вы задали соответствующую настройку!

####Подборки

В данном разделе вы можете связать подборки базы Collaps с категориями вашего сайта. Можно либо присвоить материалам, попадающим под подборку, нужную вам категорию, либо просто проставить подборки, под которые подходит материал в отдельное поле.
